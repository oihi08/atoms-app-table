(function(){"use strict";var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Atoms.Atom.TableRow=function(_super){function TableRow(){return TableRow.__super__.constructor.apply(this,arguments)}return __extends(TableRow,_super),TableRow.template='<tr {{#if.style}}class="{{style}}"{{/if.style}}></tr>',TableRow.base="TableRow",TableRow.events=["touch"],TableRow.prototype._render=function(){var field,fields,index,tds,value,values,_base,_i,_len,_ref;if(TableRow.__super__._render.apply(this,arguments),null!=this.entity){for(tds="",fields=this.entity.constructor.attributes,this.parent.attributes.columns&&(fields=function(){var _results;_results=[];for(field in this.parent.attributes.columns)_results.push(field);return _results}.call(this)),values=("function"==typeof(_base=this.entity).parse?_base.parse():void 0)||this.entity.attributes(),_ref=this.entity.constructor.attributes,index=_i=0,_len=_ref.length;_len>_i;index=++_i)field=_ref[index],__indexOf.call(fields,field)>=0&&(value=values[field]||this.entity[field]||"",tds+='<td data-row-field="'+field+'" data-row-index="'+index+'">'+value+"</td>");return this.el.html(tds)}},TableRow}(Atoms.Class.Atom),Atoms.Molecule.Table=function(_super){function Table(){this.select=__bind(this.select,this),this.findBy=__bind(this.findBy,this),Table.__super__.constructor.apply(this,arguments),this.el=this.el.find("tbody")}return __extends(Table,_super),Table["extends"]=!0,Table.template='<table {{#if.style}}class="{{style}}"{{/if.style}}>\n  {{#if.caption}}<caption>{{caption}}</caption>{{/if.caption}}\n  <tbody></tbody>\n</table>',Table.available=["Atom.TableRow"],Table.base="Table",Table.events=["select"],Table.prototype._render=function(){var columns,name,type,_ref;if(Table.__super__._render.apply(this,arguments),this.attributes.columns){columns="",_ref=this.attributes.columns;for(name in _ref)type=_ref[name],columns+="<th data-row-field="+name+' draggable="true">'+name+"</th>";return this.el.prepend("<thead><tr >"+columns+"</tr></thead>"),this._bindColumnOrder()}},Table.prototype.findBy=function(field,value){return this.select(function(entity){var _ref;return(null!=(_ref=entity[field])?_ref.toLowerCase().trim():void 0)===value.toLowerCase().trim()?entity:void 0})},Table.prototype.select=function(callback){var record,records,_i,_len,_ref,_results;for(this.clean(),this.children=[],callback&&(records=function(){var _i,_len,_ref,_results;for(_ref=this.cache,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)record=_ref[_i],callback(record.entity)&&_results.push(record);return _results}.call(this)),_ref=records||this.cache,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)record=_ref[_i],_results.push(this._addAtomEntity(record.entity,this.attributes.bind,record=!1));return _results},Table.prototype.all=function(){return this.select()},Table.prototype.row=function(value){var atom,_i,_len,_ref;if(isNaN(value)){if(null!=(null!=value?value.uid:void 0))for(_ref=this.cache,_i=0,_len=_ref.length;_len>_i&&(atom=_ref[_i],atom.entity.uid!==value.uid);_i++);}else atom=this.children[value];return atom?this._activeRow(atom):void 0},Table.prototype.onTableRowTouch=function(event,atom){return this.bubble("select",atom),this._activeRow(atom),!1},Table.prototype._bindColumnOrder=function(){return this.el.find("thead th").on("touch",function(_this){return function(event){var el,field,order,ordered_entities,record;return el=event.target,order=el.getAttribute("data-row-order"),order=order&&"desc"!==order?"desc":"asc",el.setAttribute("data-row-order",order),field=el.getAttribute("data-row-field").toLowerCase(),ordered_entities=function(){var _i,_len,_ref,_results;for(_ref=this.cache,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)record=_ref[_i],_results.push(record.entity);return _results}.call(_this).sort(function(a,b){return"asc"===order?(a[field]||"")>(b[field]||"")?1:-1:(a[field]||"999")<(b[field]||"999")?1:-1}),_this.cache=[],_this.entity(ordered_entities)}}(this)),this.el.find("thead th").on("dragstart",function(_this){return function(event){return _this.source=event.target}}(this)),this.el.find("thead th").on("dragend",function(_this){return function(){return Atoms.$(_this.source).siblings().removeClass("drag"),_this.source=void 0}}(this)),this.el.find("thead th").on("dragover",function(_this){return function(event){return _this.source!==event.target?Atoms.$(event.target).addClass("drag").siblings().removeClass("drag"):Atoms.$(_this.source).siblings().removeClass("drag")}}(this))},Table.prototype._activeRow=function(atom){return atom.el.addClass("active").siblings().removeClass("active")},Table}(Atoms.Class.Molecule)}).call(this);